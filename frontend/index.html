<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Otodom Listings Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        #map { height: 100vh; }
    </style>
</head>
<body>
<div id="map"></div>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const map = L.map('map').setView([52.2297, 21.0122], 11);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Â© OpenStreetMap contributors'
}).addTo(map);

fetch('http://localhost:8000/listings')
  .then(r => r.json())
  .then(listings => {
    listings.forEach(l => {
      const marker = L.marker([l.lat, l.lng]).addTo(map);
      const lines = [
        `<b>${l.title}</b>`,
        `<b>Price:</b> ${l.price}`
      ];
      if (l.commutes) {
        Object.entries(l.commutes).forEach(([dest, min]) => {
          if (min !== null) {
            lines.push(`<b>\ud83d\ude8d ${dest}:</b> ${min} min`);
          }
        });
      }
      lines.push(`<a href="${l.url}" target="_blank">Open</a>`);
      marker.bindPopup(lines.join('<br/>'));
    });
  })
  .catch(err => console.error(err));
</script>
</body>
</html>
